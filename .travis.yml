language: python
python:
- '3.3'
- '3.4'
- nightly
matrix:
  allow_failures:
  - python: nightly
cache:
  directory:
  - "$HOME/.cache/pip"
install:
- pip install -r test_requirements.txt
- pip install .
before_script:
- psql -U postgres -c "DROP DATABASE IF EXISTS slamon;"
- psql -U postgres -c "DROP DATABASE IF EXISTS slamon_tests;"
- psql -U postgres -c "DROP USER IF EXISTS afm;"
- psql -U postgres -c "CREATE DATABASE slamon;"
- psql -U postgres -c "CREATE DATABASE slamon_tests;"
- psql -U postgres -c "CREATE USER afm WITH PASSWORD 'changeme';"
- psql -U postgres -c "GRANT ALL ON DATABASE slamon TO afm;"
- psql -U postgres -c "GRANT ALL ON DATABASE slamon_tests TO afm;"
- python ./slamon_afm/admin.py --create-tables
script:
- nosetests --with-coverage --cover-erase --cover-package=slamon_afm
notifications:
  webhooks:
    urls:
    - secure: feEKRGM5pwxP6FenUYuGRNgxXj4O5vQfSsm8x3Zmv//pau4CEnKJ10R58Knu4aHdNuRab5U9OZF7vtcdCOtxdUUWULmCj5XFgUOdcyXpgkdMN9zkcV54bTU2DdwRqXX19h1Uas+bTxVvJLQy+OWX9BaGXvCcHKXvhh5OmcRoLmoHcpizrnMkahAh7uaOuhqgSVV/vSRv/RLYACrIbyT40b/CXeHenraJhLZMXBYtgTkgXQaxIjXHEZp3bcuYM2ErQCoRxvT32RO+qBtWthAWhpzFATBLKIYUoyJmPUvfFuD5iGOdPEvSm7Xkwh2efLFNsRqwMJwPFg5+tCjFo/Ln2zgZ4PwNHA9BE9H4W7RderqSQlMz6N/uQDeXJJiFWB1IWZUVMuPBuM89sfALvPmlxD4jUbokJwgJBkGiX7CdNM7kZKzMytqAGBtemgwWGBSd3AY9YA/8mTR7mY18hWxAjfrAB8v7U9/BjvZycgXGO6kmAGn3gWJF7JTxwl/Awr/TrOPt/1zT0jyAc8x5YWLoiUhiA/PHcM4TmNm877jsCRROxUJgGvHlOFYKjKAYSay6Uj7CBS2OLaepclReRRXKokgdi6SZrwbBkwSAwzZ7aRoecZ0IZ2LGa0752dlHIK/ZaFd0eWlFYWBbL8n2GawlI7qp4bBzfs5T0gaSWgO8mYQ=
  "    on_success": change
  "    on_failure": always
  "    on_start": false
after_success:
- overalls
deploy:
  provider: pypi
  user: slamon
  password:
    secure: Wlx7B2JX0gkkYAABOUNByNFCMOz+qy7c05VPXYJ24n4U17BH/lzZgJwoeIJ1cJ2/rD46p97WG45zcqIi+U0hb74NeK2fz3kS075k3N8tZJ4m7UfSoqetY4Ilk4Vpiu8YkpvzPWbQWfEU2kvOED8j75vRNQoqC468uABEhP2ESqySB7ZFud+2TOXG+EfrsQPihqM8nBBPBzOR2i5E+HvVIvjEG15mhq7fkD7997Rf7apT2JZ3fjO3EuVtxyEstxDhDVye6EpPU58R5R3zC/NdpOWPqz3KzYLmrkNiXwiaiBJvANfkh9DJh5NkDas7jpL1P45HMYplSRt6xiyEdsgjjKacXn3H7Mo8Feow+C77FCGZ9bqOSWWtpo6Gp5hBqFgTiRZmINXQiIrgumhBHzmgCYOE3+6nDVDkRLkU8Ky1Eat64lJlBkbIFFFRM0ULzr1g8aVcGGNJw5LUtflJCjP8PlkkOmBS9fpkhgMxbRhmvEB9rPZ/hANNzrFrXwjK2+cmny3RHWm9e+yQap/7qvNuv32nuyr62w8l7ZVWGhYbGKRKu+ysWLfJABKxRIMEfRps8K7U+DVkVXuwTFvWpXDe8DfiKGKF1sz6faz9+t/gDegDrM01ao4tTERtlhUOSxdhu/e+o6WNQvuniavgxcVZXTZac5Hid18z/iUu2TfASdY=
  on:
    tags: true
    repo: Korkkii/slamon-agent-fleet-manager
    branch: travis_deploy
