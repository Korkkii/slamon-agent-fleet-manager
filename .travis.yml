language: python
python:
- '3.3'
- '3.4'
- nightly
matrix:
  allow_failures:
  - python: nightly
cache:
  directory:
  - "$HOME/.cache/pip"
addons:
  apt_packages:
    - pandoc
install:
- pip install -r test_requirements.txt
- pip install .
before_script:
- psql -U postgres -c "DROP DATABASE IF EXISTS slamon;"
- psql -U postgres -c "DROP DATABASE IF EXISTS slamon_tests;"
- psql -U postgres -c "DROP USER IF EXISTS afm;"
- psql -U postgres -c "CREATE DATABASE slamon;"
- psql -U postgres -c "CREATE DATABASE slamon_tests;"
- psql -U postgres -c "CREATE USER afm WITH PASSWORD 'changeme';"
- psql -U postgres -c "GRANT ALL ON DATABASE slamon TO afm;"
- psql -U postgres -c "GRANT ALL ON DATABASE slamon_tests TO afm;"
- python ./slamon_afm/admin.py --create-tables
script:
- nosetests --with-coverage --cover-erase --cover-package=slamon_afm
notifications:
  webhooks:
    urls:
    - secure: feEKRGM5pwxP6FenUYuGRNgxXj4O5vQfSsm8x3Zmv//pau4CEnKJ10R58Knu4aHdNuRab5U9OZF7vtcdCOtxdUUWULmCj5XFgUOdcyXpgkdMN9zkcV54bTU2DdwRqXX19h1Uas+bTxVvJLQy+OWX9BaGXvCcHKXvhh5OmcRoLmoHcpizrnMkahAh7uaOuhqgSVV/vSRv/RLYACrIbyT40b/CXeHenraJhLZMXBYtgTkgXQaxIjXHEZp3bcuYM2ErQCoRxvT32RO+qBtWthAWhpzFATBLKIYUoyJmPUvfFuD5iGOdPEvSm7Xkwh2efLFNsRqwMJwPFg5+tCjFo/Ln2zgZ4PwNHA9BE9H4W7RderqSQlMz6N/uQDeXJJiFWB1IWZUVMuPBuM89sfALvPmlxD4jUbokJwgJBkGiX7CdNM7kZKzMytqAGBtemgwWGBSd3AY9YA/8mTR7mY18hWxAjfrAB8v7U9/BjvZycgXGO6kmAGn3gWJF7JTxwl/Awr/TrOPt/1zT0jyAc8x5YWLoiUhiA/PHcM4TmNm877jsCRROxUJgGvHlOFYKjKAYSay6Uj7CBS2OLaepclReRRXKokgdi6SZrwbBkwSAwzZ7aRoecZ0IZ2LGa0752dlHIK/ZaFd0eWlFYWBbL8n2GawlI7qp4bBzfs5T0gaSWgO8mYQ=
  "    on_success": change
  "    on_failure": always
  "    on_start": false
after_success:
- overalls
- pip install pypandoc
deploy:
  provider: pypi
  user: slamon
  server: https://testpypi.python.org/pypi
  password:
    secure: fTjbsOTMXp9m9QREp5fhBhIhlSJfh4E7tSlelvbFv4EJjZUXIXo/bNlOv13UOqDvRTi6pspdw+jPjUJJVRSK5h2Jo6JuMKwT8b3ccZmFqvj2/9K/fPp7k6n9qAdvcXaC9JifCIPg0C1+6whRtaNS6Uj2r8oEJ0f/smpKDi+5nDxHq7m/HF2bEGmuE9Drlf8Uus31kgVtyrtSlWfp8GlVvGXl1WEp8A5eSGhoRDw2U0YJCnSNBplXePFrpy4vDigBAeXIfFdCG2iwWv3/BERcy77FdmB53ovqHrK1LRehkKVMH92DOGXV1UPixxAWNBCagRrsPIOg5ZoR+UXLq/ZCsbc9TQyUDK0lw0nji4HuhtEff9y5xUcjS7jjGtguRAIcd0Mh95as36U48EEcHf0W7PdNo4dZDGJYfdw1Jw//lXg7yjcvP/qxdN1f2SEI9l2+Kwh+vVFAb26TSZDNOljpoNh9MV0vXSy6IyhYcToQ5MbYmDIggoskjXV83fqmCRKGvthMYsNnC6yuUUpOLD2Bd7oTgEBMYNsCeyMerNHQ7L1QjfgGPNPAI+Isi5XqoS1fNEOQ5hV2EjBL0+fN+ngnmF3/GnzaCgR+6HOeRQ3aAvkys1Xwwzm/ifwlKI2DZwJPBeE8CVY9qxKHya9s64loATOmg+j5ff76ZnAm30xn/mE=
  on:
    tags: true
    repo: Korkkii/slamon-agent-fleet-manager
    branch: separation
